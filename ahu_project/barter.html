<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ù‚Ø§ÙŠØ¶Ø© - Ø³ÙˆÙ‚ Ø§Ù„Ø­Ø³ÙŠÙ†</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        header { background: #006400; color: white; padding: 20px; text-align: center; border-radius: 15px; margin-bottom: 20px; }
        .barter-card { background: white; border-radius: 15px; padding: 15px; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-right: 5px solid #B8860B; }
        .barter-info { display: flex; justify-content: space-between; align-items: center; }
        .exchange-icon { font-size: 24px; color: #B8860B; }
        .add-form { background: white; padding: 20px; border-radius: 15px; margin-bottom: 30px; border: 2px dashed #006400; }
        input, button { padding: 10px; margin: 5px; border-radius: 8px; border: 1px solid #ddd; }
        button { background: #006400; color: white; cursor: pointer; border: none; font-weight: bold; }
    </style>
</head>
<div id="chat-icon" onclick="toggleChatBox()" style="position: fixed; top: 20px; right: 20px; width: 60px; height: 60px; background: #075e54; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 30px; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 9999; border: 2px solid white; display: none;">
    ğŸ’¬
</div>

<div id="chat-app-container" style="display: none; position: fixed; top: 90px; right: 20px; width: 320px; background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.2); z-index: 9998; font-family: sans-serif; text-align: right;">
    <div style="background: #075e54; color: white; padding: 10px;">
        <strong>Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ù…Ù‚Ø§ÙŠØ¶Ø© ğŸ”„</strong>
    </div>
    <div id="chatWindow" style="height: 250px; background: #e5ddd5; padding: 10px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px;"></div>
    <div style="padding: 10px; display: flex; gap: 5px; background: #f0f0f0;">
        <input type="text" id="chatInput" placeholder="Ø§ÙƒØªØ¨ Ø¹Ø±Ø¶Ùƒ Ù‡Ù†Ø§..." style="flex: 1; border: none; padding: 10px; border-radius: 20px;">
        <button onclick="sendChatMessage()" style="background: #075e54; color: white; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer;">â¤</button>
    </div>
</div>
<body>

<header>
    <h1>ğŸ”„ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù‚Ø§ÙŠØ¶Ø© (Ø¨Ø¯Ù‘Ù„ ØºØ±Ø¶ Ø¨ØºØ±Ø¶)</h1>
    <p>Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø­Ø³ÙŠÙ† Ø¨Ù† Ø·Ù„Ø§Ù„ - Ù…Ù†ØµØ© Ø§Ù„ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ</p>
</header>

<div class="add-form">
    <h3>Ø¹Ø±Ø¶ ØºØ±Ø¶ Ù„Ù„Ù…Ù‚Ø§ÙŠØ¶Ø©:</h3>
    <input type="text" id="myItem" placeholder="Ø´Ùˆ Ø§Ù„ØºØ±Ø¶ Ø§Ù„Ù„ÙŠ Ù…Ø¹ÙƒØŸ (Ù…Ø«Ù„Ø§Ù‹: ÙƒØªØ§Ø¨ ÙƒØ§Ù„ÙƒÙˆÙ„Ø§Ø³)">
    <span class="exchange-icon">â‡„</span>
    <input type="text" id="wantedItem" placeholder="Ø´Ùˆ Ø¨Ø¯Ùƒ Ø¨Ø¯Ø§Ù„Ù‡ØŸ (Ù…Ø«Ù„Ø§Ù‹: Ø³Ù…Ø§Ø¹Ø§Øª Ù„Ø§Ø¨ØªÙˆØ¨)">
    <button onclick="addBarter()">Ø§Ù†Ø´Ø± Ø§Ù„Ø¹Ø±Ø¶</button>
</div>

<div id="barterList">
    </div>

<script>
    // --- Ø£ÙˆÙ„Ø§Ù‹: Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…Ù‚Ø§ÙŠØ¶Ø© ---
    function addBarter() {
        const myItem = document.getElementById('myItem').value;
        const wantedItem = document.getElementById('wantedItem').value;

        if(!myItem || !wantedItem) {
            alert("Ø¹Ø¨Ù‘ÙŠ Ø§Ù„Ø®Ø§Ù†ØªÙŠÙ† ÙŠØ§ ØºØ§Ù„ÙŠ!");
            return;
        }

        const barters = JSON.parse(localStorage.getItem('barters')) || [];
        barters.push({ myItem, wantedItem, user: "Ø·Ø§Ù„Ø¨ Ø­Ø³ÙŠÙ†" });
        localStorage.setItem('barters', JSON.stringify(barters));
        
        document.getElementById('myItem').value = "";
        document.getElementById('wantedItem').value = "";
        loadBarters();
    }

    function loadBarters() {
        const list = document.getElementById('barterList');
        const barters = JSON.parse(localStorage.getItem('barters')) || [];
        
        list.innerHTML = "<h3>Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</h3>";
        
        barters.forEach((b) => {
            list.innerHTML += `
                <div class="barter-card">
                    <div class="barter-info">
                        <div>
                            <strong>Ù…Ø¹ÙŠ:</strong> ${b.myItem} <br>
                            <span style="color: #006400;"><strong>Ø¨Ø¯ÙŠ:</strong> ${b.wantedItem}</span>
                        </div>
                        <div class="exchange-icon">ğŸ”„</div>
                        <button onclick="startBarterChat('${b.myItem}')" style="background: #B8860B; color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer;">ØªÙˆØ§ØµÙ„ Ù„Ù„Ù…Ù‚Ø§ÙŠØ¶Ø©</button>
                    </div>
                </div>
            `;
        });
    }

    // --- Ø«Ø§Ù†ÙŠØ§Ù‹: ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ù„ÙŠ Ø³Ø£Ù„Øª Ø¹Ù†Ù‡ (Ø­Ø·Ù‡ Ù‡ÙˆÙ†) ---
    let currentBarterKey = "";

    function startBarterChat(itemName) {
        currentBarterKey = "chat_barter_" + itemName;
        document.getElementById('chat-icon').style.display = "flex";
        document.getElementById('chat-app-container').style.display = "block";
        loadMessages();
    }

    function toggleChatBox() {
        const box = document.getElementById('chat-app-container');
        box.style.display = (box.style.display === "none") ? "block" : "none";
    }

    function loadMessages() {
        const chatWindow = document.getElementById('chatWindow');
        const messages = JSON.parse(localStorage.getItem(currentBarterKey)) || [];
        chatWindow.innerHTML = "";
        messages.forEach(msg => {
            chatWindow.innerHTML += `
                <div style="align-self: flex-end; background: #dcf8c6; padding: 8px; border-radius: 10px; max-width: 80%; font-size: 13px; margin-bottom: 5px;">
                    ${msg.text}
                </div>`;
        });
        chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    function sendChatMessage() {
        const input = document.getElementById('chatInput');
        if (input.value.trim() === "") return;

        const messages = JSON.parse(localStorage.getItem(currentBarterKey)) || [];
        messages.push({ text: input.value });
        localStorage.setItem(currentBarterKey, JSON.stringify(messages));
        
        input.value = "";
        loadMessages();
    }

    window.onload = loadBarters;
</script>




<a href="home.html" style="
    display: inline-block;
    margin-bottom: 15px;
    text-decoration: none;
    color: #006400;
    font-weight: bold;
    font-size: 16px;
    background: white;
    padding: 8px 15px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
">
    â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
</a>
<button onclick="window.location.href='home.html'" style="
    position: absolute;
    top: 20px;
    right: 20px;
    background: #ffffff;
    color: #006400;
    border: 2px solid #006400;
    padding: 10px 15px;
    border-radius: 50px;
    cursor: pointer;
    font-weight: bold;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    z-index: 1000;
">
    ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
</button>


</body>
</html>